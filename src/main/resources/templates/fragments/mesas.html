<head>
    <link rel="stylesheet" th:href="@{/css/mesasStyle.css}" href="/css/mesasStyle.css">
</head>
<div class="wrap" th:fragment="mesasView">
    <aside class="sidebar">
        <h3>Resumen de Estados</h3>
        <div class="status-item status-verde">
            <span>Mesas Libres</span>
            <span id="countVerde" th:text="${resumenMesas.countLibres}">0</span>
        </div>
        <div class="status-item status-azul">
            <span>Esperando Pedido</span>
            <span id="countAzul" th:text="${resumenMesas.countEsperandoPedido}">0</span>
        </div>
        <div class="status-item status-amarillo">
            <span>Falta Atención</span>
            <span id="countAmarillo" th:text="${resumenMesas.countFaltaAtencion}">0</span>
        </div>
        <div class="status-item status-rojo">
            <span>Pedido Entregado</span>
            <span id="countRojo" th:text="${resumenMesas.countPedidoEntregado}">0</span>
        </div>

        <hr style="margin:14px 0; border:none; border-top:1px solid var(--color-borde);">
        <div>
            <small>Vista reducida de mesas y resumen. Click en una mesa muestra su número (demo).</small>
        </div>
    </aside>

    <main class="mesas-panel">
        <div class="mesas-container" id="mesasGrid">
            <div th:each="mesaDTO : ${listaDeMesas}"
                 class="mesa"
                 th:attr="data-id=${mesaDTO.id}, data-numero=${mesaDTO.number}, data-status-enum=${mesaDTO.status}">

                <div class="mesa-numero" th:text="${mesaDTO.number}">?</div>
                <div class="mesa-estado">Cargando...</div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="tableActionModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="tableActionModalTitle">Mesa N° <span class="modal-title-table-number">?</span></h2>
                <button class="modal-close" id="closeTableActionModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="modalActionTableNumber" value="">

                <p>Selecciona una acción para esta mesa.</p>

                <div class="action-button-grid">

                    <button class="action-button action-button-primary" id="btnGoCreateOrder">
                        <span class="action-button-icon">📝</span>
                        <span>Crear Pedido</span>
                    </button>

                    <button class="action-button" id="btnGoChangeTableStatus">
                        <span class="action-button-icon">🔄</span>
                        <span>Cambiar Estado</span>
                    </button>
                </div>

                <div class="btn-group" style="margin-top: 20px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" id="cancelTableAction">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="tableStatusModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="tableStatusModalTitle">Cambiar Estado: Mesa N° <span class="modal-title-table-number">?</span></h2>
                <button class="modal-close" id="closeTableStatusModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="modalTableNumberInput" value="">

                <p>Selecciona el nuevo estado para la mesa.</p>

                <div class="status-button-grid">
                    <button class="status-button" data-status="DISPONIBLE">
                        <span>Libre</span>
                    </button>
                    <button class="status-button" data-status="ESPERANDO_PEDIDO">
                        <span>Esperando Pedido</span>
                    </button>
                    <button class="status-button" data-status="FALTA_ATENCION">
                        <span>Falta Atención</span>
                    </button>
                    <button class="status-button" data-status="PEDIDO_ENTREGADO">
                        <span>Pedido Entregado</span>
                    </button>
                    <button class="status-button status-button-gris" data-status="FUERA_DE_SERVICIO">
                        <span>Fuera de Servicio</span>
                    </button>
                </div>

                <div class="btn-group" style="margin-top: 20px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" id="cancelTableStatus">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>
</div>
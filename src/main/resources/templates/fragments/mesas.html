<head>
    <link rel="stylesheet" th:href="@{/css/mesasStyle.css}" href="/css/mesasStyle.css">
</head>
<div class="wrap" th:fragment="mesasView">
    <aside class="sidebar">
        <h3>Resumen de Estados</h3>
        <div class="status-item status-verde">
            <span>Mesas Libres</span>
            <span id="countVerde" th:text="${resumenMesas.countLibres}">0</span>
        </div>
        <div class="status-item status-azul">
            <span>Esperando Pedido</span>
            <span id="countAzul" th:text="${resumenMesas.countEsperandoPedido}">0</span>
        </div>
        <div class="status-item status-amarillo">
            <span>Falta Atención</span>
            <span id="countAmarillo" th:text="${resumenMesas.countFaltaAtencion}">0</span>
        </div>
        <div class="status-item status-rojo">
            <span>Pedido Entregado</span>
            <span id="countRojo" th:text="${resumenMesas.countPedidoEntregado}">0</span>
        </div>

        <hr style="margin:14px 0; border:none; border-top:1px solid var(--color-borde);">
        <div>
            <small>Vista reducida de mesas y resumen. Click en una mesa muestra su número (demo).</small>
        </div>
    </aside>

    <main class="mesas-panel">
        <div class="mesas-container" id="mesasGrid">
            <div th:each="mesaDTO : ${listaDeMesas}"
                 class="mesa"
                 th:attr="data-numero=${mesaDTO.number}, data-status-enum=${mesaDTO.status}">

                <div class="mesa-numero" th:text="${mesaDTO.number}">?</div>
                <div class="mesa-estado">Cargando...</div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="tableStatusModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="tableStatusModalTitle">Cambiar Estado: Mesa N° <span class="modal-title-restaurantTable-number">?</span>
                </h2>
                <button class="modal-close" id="closeTableStatusModal">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="modalTableNumberInput" value="">

                <div class="modal-section" id="crearPedidoSection" style="display: none;">
                    <h3 class="section-title">Acciones Rápidas</h3>
                    <button type="button" class="btn btn-crear-pedido-modal" id="crearPedidoBtn">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 6px;">
                            <path d="M8 0a1 1 0 0 1 1 1v6h6a1 1 0 1 1 0 2H9v6a1 1 0 1 1-2 0V9H1a1 1 0 0 1 0-2h6V1a1 1 0 0 1 1-1z"/>
                        </svg>
                        Crear Pedido
                    </button>
                    <hr class="section-divider">
                </div>

                <div class="modal-section">
                    <h3 class="section-title">Cambiar Estado de Mesa</h3>
                    <p class="section-description">Selecciona el nuevo estado para la mesa.</p>

                    <div class="status-button-grid">
                        <button class="status-button status-button-verde" data-status="DISPONIBLE">
                            <span class="status-icon">✓</span>
                            <span class="status-label">Libre</span>
                        </button>
                        <button class="status-button status-button-azul" data-status="ESPERANDO_PEDIDO">
                            <span class="status-icon">⏱</span>
                            <span class="status-label">Esperando Pedido</span>
                        </button>
                        <button class="status-button status-button-amarillo" data-status="FALTA_ATENCION">
                            <span class="status-icon">⚠</span>
                            <span class="status-label">Falta Atención</span>
                        </button>
                        <button class="status-button status-button-rojo" data-status="PEDIDO_ENTREGADO">
                            <span class="status-icon">✓</span>
                            <span class="status-label">Pedido Entregado</span>
                        </button>
                        <button class="status-button status-button-gris" data-status="FUERA_DE_SERVICIO">
                            <span class="status-icon">✕</span>
                            <span class="status-label">Fuera de Servicio</span>
                        </button>
                    </div>
                </div>

                <div class="btn-group" style="margin-top: 20px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" id="cancelarTableStatus">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="orderModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Crear Pedido - Mesa N° <span id="orderModalTableNumber">?</span></h2>
                <button class="modal-close" id="closeOrderModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-creation-container">
                    <div class="plates-section">
                        <h3>Platos Disponibles</h3>
                        <div id="platesList" class="plates-list">
                        </div>
                    </div>
                    <div class="order-summary-section">
                        <h3>Resumen del Pedido</h3>
                        <div id="orderSummary" class="order-summary">
                        </div>
                        <div class="order-total">
                            <strong>Total: S/ <span id="orderTotal">0.00</span></strong>
                        </div>
                    </div>
                </div>
                <div class="btn-group" style="margin-top: 20px; justify-content: flex-end;">
                    <button type="button" class="btn btn-danger" id="cancelOrder">Cancelar</button>
                    <button type="button" class="btn btn-success" id="submitOrder">Crear Pedido</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>
</div>